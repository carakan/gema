<div class="breadcrumps">
  <%= link_to "Lista de importaciones", importaciones_path %> > 
  <%= link_to "Agentes y Títulares", reporte_marcas_path(:importacion_id => params[:importacion_id]) %>
  > Reporte
</div>

<h1>Editar reporte cruce</h1>
<h2 class="dark"><%= params[:representante_type] %>: <%= @representante %></h2>
<h2 class="dark">Gaceta <%= @importacion.publicacion %> del <%= l @importacion.publicacion_fecha %></h2>


<% semantic_form_for(@reporte_marca) do |f| %>

  <%= f.input :representante_id, :as => :hidden %>
  <%= f.input :representante_type, :as => :hidden %>
  <%= f.input :importacion_id, :as => :hidden %>

  <p>
    <label for="reporte_marca_idioma_es">
      <%= f.radio_button :idioma, 'es' %>
      Español
    </label>
    <label for="reporte_marca_idioma_en">
      <%= f.radio_button :idioma, 'en' %>
      Ingles
    </label>
  </p>
  <%= f.input :carta, :as => :text, :input_html => {:cols => 100, :rows => 7} %>

  <p class="inline-hints">
    Si no escribe en el comentario la marca no sera seleccionada para reporte
  </p>
  <table class="decorated">
  	<tr>
  		<th>Marca propia</th>
  		<th>Marca agena</th>
  		<th>Comentario</th>
  	</tr>
    <%# @marcas.each{ |v| f.object.reporte_marca_detalles.build(:marca_id => v.marca_id, :marca_foranea_id => v.consulta.marca_id) } if params[:reporte_marca].nil? %>
    <% @i = 0 %>
    <% f.semantic_fields_for :reporte_marca_detalles do |rd| %>
      <tr>
        <td>
          <%= rd.input :marca_id, :as => :hidden %>
          <%= rd.input :marca_foranea_id, :as => :hidden %>
          <strong><%= rd.object.marca_propia.nombre %></strong>
          <br />
          Clase <%= rd.object.marca_propia.clase_id %><br />
          <%= rd.object.marca_propia.tipo_signo %><br />
          <%= l rd.object.marca_propia.estado_fecha, :format => :date %>
        </td>
        <td>
          <strong><%= rd.object.marca_foranea.nombre %></strong><br />
          Clase <%= rd.object.marca_foranea.clase_id %><br />
          <%= rd.object.marca_foranea.tipo_signo %><br />
          <%= l rd.object.marca_foranea.estado_fecha, :format => :date %><br />
          <span class="grey b">Títulares:</span>
          <%= rd.object.marca_foranea.titulares.join(", ") %><br />
        </td>
        <td>
          <%= rd.input :comentario, :as => :text, :label => false, :input_html => {:cols => 60, :rows => 12} %>
        </td>
      </tr>
      <% @i += 1 %>
    <% end %>
  </table>
  <p>
    <%= f.submit 'Salvar' %>
  </p>
<% end %>

<script type="text/javascript">
  $(function() {
      // Idioma
      $('input[name="reporte_marca[idioma]"]').click(function() {
        var val = 'es' == $(this).val() ? carta_es : carta_en;
        $('#reporte_marca_carta').val(val);
      });
      if( $('input[name="reporte_marca[idioma]"]').val() == 'es') {
        $('#reporte_marca_carta').val(carta_es);
      }else {
        $('#reporte_marca_carta').val(carta_en);
      }

      // Habilitar desabilitar
      /*$('input:checkbox').click(function() {
        $(this).parents("tr:first").find("td textarea").attr("disabled", !$(this).attr("checked"));
      });*/
      // Formulario
      $('form').submit(function() {
        /*if( $('input:checkbox[checked]').length <= 0 ) {
          alert("Debe seleccionar al menos una marca");
          return false;
        }else{
          return true;
        }*/
      });
  });
  var carta_es = "Estimado cliente le enviamos las coincidencias de sus marcas en la gaceta \"<%= @importacion.publicacion %>\" de fecha <%= l @importacion.publicacion_fecha %>";
  <% I18n.locale = :en %>
  var carta_en = "Dear customer we have found some coincidences with your trademarks in gaceta \"<%= @importacion.publicacion %>\" from date <%= l @importacion.publicacion_fecha %>";
  <% I18n.locale = :es %>
</script>
