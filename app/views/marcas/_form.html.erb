<%= stylesheet_link_tag 'facebook' %>
<%= javascript_include_tag 'jquery.fcbkcomplete.min' %>

<%= simple_form_for(@marca,:html => { :multipart => true } ) do |f| -%>
  <%= hidden_field_tag "importacion_id", params[:importacion_id] unless params[:importacion_id].nil?  %>

  <%= f.hidden_field :valido, :value => 1 %>

  <%= f.input :propia, :label => 'Marca propia' %>
  <%= f.input :activa, :label => 'Marca activa' %>

  <%= f.input :tipo_signo_id, :as => :hidden %>
  <%= f.association :tipo_signo, :input_html => {:disabled => true} %>

  <!--<li>
    <label for="">Tipo de signo</label>
    <%#= @marca.tipo_signo %>
    <%#= "<span class=\"error\">#{ @marca.errors.on(:tipo_signo_id) }</span>" %>
    </li>-->

  <%= f.association :tipo_marca %>

  <%= f.input :nombre,:label => "Denominación",:tabindex => 3 %>
  <% if @marca.con_imagen? %>
    <li>
    <%= image_tag @marca.adjuntos.last.archivo.url(:mini), :class => 'mini' if @marca.adjuntos.size > 0 %>
      <% unless @marca.try(:tipo_signo_id) == 4 %>
          <label for="">Imagen</label>
          <input type="file" name="marca[adjuntos_attributes][0][archivo]" size= "30" />
          <%# adj.file_field :archivo, :size => 30 %>
      <% end %>
    </li>
  <% end %>

  <%= f.input :descripcion_imagen,:label => 'Descripcion diseño', :as => :text, :input_html => { :rows => 10, :cols => 115 }, :tabindex => 5 %>
  <%= f.association :clase, :tabindex => 5 %>
  <%= f.input :productos, :label=>"Descripción productos/servicios", :as => :text, :input_html => { :rows => 10, :cols => 115 }, :tabindex => 7 %>

    <%= link_to 'Nuevo cliente', new_representante_path('data-title' => 'Crear cliente'), :class => 'new ajax' %>

    <li style="position:relative;width:440px;float:left;margin-right: 10px">
      <%= label_tag "marca_agente_ids_", "Agentes" %>
      <%= f.collection_select :agente_ids, Representante.find(f.object.agente_ids), :id, :to_s, {}, {:multiple => true} %>
    </li>

    <li style="position:relative;width:440px;float:left">
      <%= label_tag "marca_titular_ids_", "Titulares" %>
      <%= f.collection_select :titular_ids, Representante.find(f.object.titular_ids), :id, :to_s, {}, {:multiple => true} %>
    </li>

    <div class="clear"></div>
    <li>
        <%= f.input :apoderado, :tabindex => 11 %>
    </li>
    <li>
        <%= f.input :representante_empresarial, :tabindex => 12 %>
    </li>

    <div class="clear"></div>

  <%= f.input :fecha_instruccion , :as => 'string', :input_html => { :class => 'date' } %>
  <%= f.input :instruccion, :collection => Marca::INSTRUCCIONES, :label => 'Tipo de instrucción' %>
  
  <%= f.input :estado, :collection => Marca.lista_estados , :tabindex => 10 %>

  <%= f.association :marca_estado %>
  <%= f.input :numero_solicitud , :tabindex => 13  %>
  <%# f.input :estado_fecha, :label => 'Fecha solicitud',:as => :string, :input_html => {:tabindex => 14, :class => 'date' } %>
  <li class="date">
    <%= f.label :estado_fecha, "Fecha hora solicitud" %>
    <%= f.datetime_select :estado_fecha %>
  </li>
  <%= f.input :numero_gaceta, :label => 'Número de gaceta' , :tabindex => 17  %>
  <%= f.input :numero_publicacion,:label => 'Número de publicación' , :tabindex => 15  %>
  <%= f.input :fecha_publicacion, :as => 'string', :input_html => { :tabindex => 16, :class => 'date' } %>

  <%= f.input :numero_registro,:label => 'Número de registro' , :tabindex => 18 %>
  <%= f.input :fecha_registro, :as => 'string', :input_html => { :tabindex => 19, :class => 'date'  } %>

  <% unless @marca.errores_manual.blank? %>
    <h3 class="error">Existen errores de comparación</h3>

    <% @marca.errores_manual.try(:each) do |k, v| %>
      <div class="error_manual erro error">
        <div>
          <%= hidden_field_tag "marca[errores_manual][#{k}]", v  %>
          <%= k.to_s.humanize %>: <%= v %>
          <a href="javascript:">borrar</a>
        </div>
      </div>
    <% end %>
    <p class="inline-hints">
      Debe borrar los errores para que pueda validar el signo al salvar
    </p>
  <% end %>

  <div style="clear:both; height: 30px"></div>
  <%= f.submit "Salvar" , :tabindex => 21  %>
<% end -%>

<div style="clear:both"></div>


<script type="text/javascript">

$(document).ready(function() {
  // Para que pueda adicionar el plugin de facebook los elementos seleccioandos
  $("#marca_agente_ids").find('option').addClass('selected');
  $("#marca_titular_ids").find('option').addClass('selected');

  // Plugin facebook
  $("#marca_agente_ids").fcbkcomplete({
    json_url: "/representantes/buscar",
    filter_hide: true,
    filter_selected: true,
    newel: false
  });
  $("#marca_titular_ids").fcbkcomplete({
    json_url: "/representantes/buscar",
    filter_hide: true,
    filter_selected: true,
    newel: false
  });


  $('.error_manual a').click(function(){
    $(this).parents("div:first").remove();
    verificarErrorresManuales();
  });

  if( $('#marca_tipo_marca_id').val() == "1" ) {
    $('#marca_clase_id option').each( function(i, el) {
      if( parseInt( $(el).val() ) >= 35) {
        $(el).remove();
      }
    });
  }

  if( $('#marca_tipo_marca_id').val() == "2" ) {
    $('#marca_clase_id option').each( function(i, el) {
      if( parseInt( $(el).val() ) <= 34) {
        $(el).remove();
      }
    });
  }

  if ($('#marca_tipo_signo_id').val() == "2"){
    $('#marca_nombre').val("Diseño").hide().after("<span>Diseño</span>");
  }
  
  if ($('#marca_tipo_signo_id').val() == "1"){
    $('#marca_descripcion_imagen_input').hide();
    $('#marca_descripcion_imagen').val(" Descripcion diseño").hide();
  }

});


  
</script>
